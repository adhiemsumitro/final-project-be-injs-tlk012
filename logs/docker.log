

Adhiems-MacBook-Air:final-project-v2 adhiemsumitro$ docker-compose up --build
[+] Running 15/15
 ✔ db Pulled                                                                                                           31.6s
   ✔ 14c9d9d19932 Pull complete                                                                                         8.6s
   ✔ 40c88e7faf79 Pull complete                                                                                         8.7s
   ✔ 86552d6a2e14 Pull complete                                                                                         8.7s
   ✔ a986120aadb7 Pull complete                                                                                         8.8s
   ✔ b8f6f593e389 Pull complete                                                                                         9.0s
   ✔ 76441873964f Pull complete                                                                                         9.0s
   ✔ c00daffc086a Pull complete                                                                                         9.0s
   ✔ 3e872bee6899 Pull complete                                                                                         9.0s
   ✔ e5fad5150511 Pull complete                                                                                        26.3s
   ✔ 9cdfe87ade9a Pull complete                                                                                        26.3s
   ✔ 80ba833808c5 Pull complete                                                                                        26.3s
   ✔ dc6814d84714 Pull complete                                                                                        26.3s
   ✔ 028c14c36d19 Pull complete                                                                                        26.3s
   ✔ 1de81e9381de Pull complete                                                                                        26.3s
[+] Building 73.9s (14/18)                                                                              docker:desktop-linux
 => [app internal] load build definition from Dockerfile.prod                                                           0.0s
 => => transferring dockerfile: 1.00kB                                                                                  0.0s
 => [app internal] load metadata for docker.io/library/node:14-slim                                                     3.1s
 => [app internal] load metadata for docker.io/library/node:14                                                          3.5s
 => [app auth] library/node:pull token for registry-1.docker.io                                                         0.0s
 => [app internal] load .dockerignore                                                                                   0.0s
 => => transferring context: 2B                                                                                         0.0s
 => [app builder 1/6] FROM docker.io/library/node:14@sha256:a158d3b9b4e3fa813fa6c8c590b8f0a860e015ad4e59bbce5744d2f6f  64.7s
 => => resolve docker.io/library/node:14@sha256:a158d3b9b4e3fa813fa6c8c590b8f0a860e015ad4e59bbce5744d2f6fd8461aa        0.0s
 => => sha256:a158d3b9b4e3fa813fa6c8c590b8f0a860e015ad4e59bbce5744d2f6fd8461aa 776B / 776B                              0.0s
 => => sha256:9aa52bf2f9f6d46c4f06b61f50c214ed4e3e3626c5d9c9c88eeb00e4f86dc3f9 2.21kB / 2.21kB                          0.0s
 => => sha256:b6e1f9016a807bec65d61745a2510b8c4b3e7a157d13c7e18a8b6b64742a511c 7.53kB / 7.53kB                          0.0s
 => => sha256:b4910c31031a0301ea4f8b7155269014925aeb17c71b869dea3ff907ba294b55 49.24MB / 49.24MB                       29.7s
 => => sha256:208fd617b499747daceba851b67da426c285d1e306b316a193f06968123f49da 7.73MB / 7.73MB                         10.5s
 => => sha256:1efadebfda1423d1b70a0e991e9ff8bb2e3fe0b08d55562359a004c265fc7c86 10.00MB / 10.00MB                       16.0s
 => => sha256:efe7e7c438113f5e58417f97e7eb0a755b17ee63eebd85a7c3b86a2aad4c993e 52.19MB / 52.19MB                       29.2s
 => => sha256:33997ebd7335eb6f55d98725b5fb8e4899166098d6db119cd6f6bc7055ffa858 183.44MB / 183.44MB                     59.1s
 => => sha256:67501d6724b266c5e1bbbcc9dc82898e05969e6d368cfd4c6893fcb8e7a3fd9c 4.20kB / 4.20kB                         30.4s
 => => extracting sha256:b4910c31031a0301ea4f8b7155269014925aeb17c71b869dea3ff907ba294b55                               1.4s
 => => sha256:852f2ac51586a06d124a05565f98697df6e9644403dcc71fc6c765201bcb05a1 35.36MB / 35.36MB                       45.5s
 => => sha256:b481e8e2da867a2e73bcc8f78b7cca9faa71a5ebf45ad5bb6fdb10a8ddc87ae5 2.29MB / 2.29MB                         33.3s
 => => extracting sha256:208fd617b499747daceba851b67da426c285d1e306b316a193f06968123f49da                               0.2s
 => => extracting sha256:1efadebfda1423d1b70a0e991e9ff8bb2e3fe0b08d55562359a004c265fc7c86                               0.1s
 => => extracting sha256:efe7e7c438113f5e58417f97e7eb0a755b17ee63eebd85a7c3b86a2aad4c993e                               1.5s
 => => sha256:d3d53ad8b21a68bf7d0a2f5356eed25705b948632b3d9f3b5638558ead638119 451B / 451B                             34.1s
 => => extracting sha256:33997ebd7335eb6f55d98725b5fb8e4899166098d6db119cd6f6bc7055ffa858                               4.0s
 => => extracting sha256:67501d6724b266c5e1bbbcc9dc82898e05969e6d368cfd4c6893fcb8e7a3fd9c                               0.0s
 => => extracting sha256:852f2ac51586a06d124a05565f98697df6e9644403dcc71fc6c765201bcb05a1                               1.2s
 => => extracting sha256:b481e8e2da867a2e73bcc8f78b7cca9faa71a5ebf45ad5bb6fdb10a8ddc87ae5                               0.0s
 => => extracting sha256:d3d53ad8b21a68bf7d0a2f5356eed25705b948632b3d9f3b5638558ead638119                               0.0s
 => [app internal] load build context                                                                                   1.3s
 => => transferring context: 52.62MB                                                                                    1.2s
 => [app stage-1 1/6] FROM docker.io/library/node:14-slim@sha256:198142146b4c47193348f6415da769bdb5035c16fcab051c38c2  15.7s
 => => resolve docker.io/library/node:14-slim@sha256:198142146b4c47193348f6415da769bdb5035c16fcab051c38c256a6b48f2e1c   0.0s
 => => sha256:198142146b4c47193348f6415da769bdb5035c16fcab051c38c256a6b48f2e1c 776B / 776B                              0.0s
 => => sha256:0fd009ded48d03615a354f35ef09559ec6afbd6a9f18074c43f10da7fde1091a 1.37kB / 1.37kB                          0.0s
 => => sha256:9769000bc4a167ef95904e26eceadba0d096faa434d8cfae102d93a03948b86a 6.81kB / 6.81kB                          0.0s
 => => sha256:27bec964ec41cf69bd5df2ffd45c27623ae4bb0eb6f9f366179f7ac9b47d9840 25.92MB / 25.92MB                        7.1s
 => => sha256:a7560a5c4bf9725a7f73063054a5580c12aa8d0568769a2d7f566185bb8020c8 4.18kB / 4.18kB                          0.9s
 => => sha256:67c27f50eddeca80f71c9997d04a6314a4cb43de80eff34c200bd6f86ef1ef78 35.81MB / 35.81MB                       14.4s
 => => sha256:18fca81b736222f4487ca1d9849085373759bc99df833cdff0d6335397cf8d3d 2.75MB / 2.75MB                          3.2s
 => => sha256:97f7825da219900f8e57c974334c9f534b83fa33d62980fd4d9e191d2c13ffa1 451B / 451B                              3.7s
 => => extracting sha256:27bec964ec41cf69bd5df2ffd45c27623ae4bb0eb6f9f366179f7ac9b47d9840                               0.8s
 => => extracting sha256:a7560a5c4bf9725a7f73063054a5580c12aa8d0568769a2d7f566185bb8020c8                               0.0s
 => => extracting sha256:67c27f50eddeca80f71c9997d04a6314a4cb43de80eff34c200bd6f86ef1ef78                               1.2s
 => => extracting sha256:18fca81b736222f4487ca1d9849085373759bc99df833cdff0d6335397cf8d3d                               0.0s
 => => extracting sha256:97f7825da219900f8e57c974334c9f534b83fa33d62980fd4d9e191d2c13ffa1                               0.0s
 => [app stage-1 2/6] WORKDIR /usr/src/app                                                                              0.4s
 => CANCELED [app stage-1 3/6] RUN apt-get update && apt-get install -y build-essential python postgresql-client wget  54.3s
 => [app builder 2/6] WORKDIR /usr/src/app                                                                              0.2s
 => [app builder 3/6] RUN apt-get update && apt-get install -y build-essential python                                   5.1s
 => [app builder 4/6] COPY package*.json ./                                                                             0.1s
 => ERROR [app builder 5/6] RUN npm ci                                                                                  0.3s
------
 > [app builder 5/6] RUN npm ci:
0.294 npm ERR! Cannot read property 'bcrypt' of undefined
0.296
0.296 npm ERR! A complete log of this run can be found in:
0.296 npm ERR!     /root/.npm/_logs/2024-09-30T04_50_23_412Z-debug.log
------
failed to solve: process "/bin/sh -c npm ci" did not complete successfully: exit code: 1

Adhiems-MacBook-Air:final-project-v2 adhiemsumitro$ docker build -f Dockerfile.prod -t myapp .
[+] Building 43.1s (18/18) FINISHED                                                                     docker:desktop-linux
 => [internal] load build definition from Dockerfile.prod                                                               0.0s
 => => transferring dockerfile: 978B                                                                                    0.0s
 => [internal] load metadata for docker.io/library/node:14-slim                                                         1.1s
 => [internal] load metadata for docker.io/library/node:14                                                              1.1s
 => [internal] load .dockerignore                                                                                       0.0s
 => => transferring context: 2B                                                                                         0.0s
 => [builder 1/6] FROM docker.io/library/node:14@sha256:a158d3b9b4e3fa813fa6c8c590b8f0a860e015ad4e59bbce5744d2f6fd8461  0.0s
 => [internal] load build context                                                                                       0.5s
 => => transferring context: 744.46kB                                                                                   0.5s
 => [stage-1 1/6] FROM docker.io/library/node:14-slim@sha256:198142146b4c47193348f6415da769bdb5035c16fcab051c38c256a6b  0.0s
 => CACHED [stage-1 2/6] WORKDIR /usr/src/app                                                                           0.0s
 => [stage-1 3/6] RUN apt-get update && apt-get install -y build-essential python postgresql-client wget     && wget   35.6s
 => CACHED [builder 2/6] WORKDIR /usr/src/app                                                                           0.0s
 => CACHED [builder 3/6] RUN apt-get update && apt-get install -y build-essential python                                0.0s
 => CACHED [builder 4/6] COPY package*.json ./                                                                          0.0s
 => [builder 5/6] RUN npm install                                                                                      17.7s
 => [builder 6/6] COPY . .                                                                                              0.9s
 => [stage-1 4/6] COPY --from=builder /usr/src/app .                                                                    0.8s
 => [stage-1 5/6] RUN npm prune --production                                                                            2.3s
 => [stage-1 6/6] RUN npm rebuild bcrypt --build-from-source                                                            2.6s
 => exporting to image                                                                                                  0.8s
 => => exporting layers                                                                                                 0.8s
 => => writing image sha256:33816929d89d3854abb56e43d42469e87604dadfeb81218d8844d6376db61109                            0.0s
 => => naming to docker.io/library/myapp                                                                                0.0s

View build details: docker-desktop://dashboard/build/desktop-linux/desktop-linux/2vz10matb0wzk6ak3zt8g7qyk

What's next:
    View a summary of image vulnerabilities and recommendations → docker scout quickview
Adhiems-MacBook-Air:final-project-v2 adhiemsumitro$

Adhiems-MacBook-Air:final-project-v2 adhiemsumitro$ docker-compose up
[+] Building 2.7s (20/20) FINISHED                                                                      docker:desktop-linux
 => [app internal] load build definition from Dockerfile.prod                                                           0.0s
 => => transferring dockerfile: 978B                                                                                    0.0s
 => [app internal] load metadata for docker.io/library/node:14-slim                                                     2.1s
 => [app internal] load metadata for docker.io/library/node:14                                                          2.1s
 => [app auth] library/node:pull token for registry-1.docker.io                                                         0.0s
 => [app internal] load .dockerignore                                                                                   0.0s
 => => transferring context: 2B                                                                                         0.0s
 => [app builder 1/6] FROM docker.io/library/node:14@sha256:a158d3b9b4e3fa813fa6c8c590b8f0a860e015ad4e59bbce5744d2f6fd  0.0s
 => [app internal] load build context                                                                                   0.5s
 => => transferring context: 744.84kB                                                                                   0.5s
 => [app stage-1 1/6] FROM docker.io/library/node:14-slim@sha256:198142146b4c47193348f6415da769bdb5035c16fcab051c38c25  0.0s
 => CACHED [app stage-1 2/6] WORKDIR /usr/src/app                                                                       0.0s
 => CACHED [app stage-1 3/6] RUN apt-get update && apt-get install -y build-essential python postgresql-client wget     0.0s
 => CACHED [app builder 2/6] WORKDIR /usr/src/app                                                                       0.0s
 => CACHED [app builder 3/6] RUN apt-get update && apt-get install -y build-essential python                            0.0s
 => CACHED [app builder 4/6] COPY package*.json ./                                                                      0.0s
 => CACHED [app builder 5/6] RUN npm install                                                                            0.0s
 => CACHED [app builder 6/6] COPY . .                                                                                   0.0s
 => CACHED [app stage-1 4/6] COPY --from=builder /usr/src/app .                                                         0.0s
 => CACHED [app stage-1 5/6] RUN npm prune --production                                                                 0.0s
 => CACHED [app stage-1 6/6] RUN npm rebuild bcrypt --build-from-source                                                 0.0s
 => [app] exporting to image                                                                                            0.0s
 => => exporting layers                                                                                                 0.0s
 => => writing image sha256:509d0631aa30bd06046f3017a89866bcb8f08db9f1244c51befcf6c40182199e                            0.0s
 => => naming to docker.io/library/final-project-v2-app                                                                 0.0s
 => [app] resolving provenance for metadata file                                                                        0.0s
[+] Running 3/3
 ✔ Network final-project-v2_default  Created                                                                            0.0s
 ✔ Container final-project-v2-db-1   Created                                                                            0.0s
 ✔ Container final-project-v2-app-1  Created                                                                            0.0s
Attaching to app-1, db-1
db-1   |
db-1   | PostgreSQL Database directory appears to contain a database; Skipping initialization
db-1   |
db-1   | 2024-09-30 04:54:35.877 UTC [1] LOG:  starting PostgreSQL 13.16 (Debian 13.16-1.pgdg120+1) on aarch64-unknown-linux-gnu, compiled by gcc (Debian 12.2.0-14) 12.2.0, 64-bit
db-1   | 2024-09-30 04:54:35.877 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
db-1   | 2024-09-30 04:54:35.877 UTC [1] LOG:  listening on IPv6 address "::", port 5432
db-1   | 2024-09-30 04:54:35.883 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
db-1   | 2024-09-30 04:54:35.889 UTC [26] LOG:  database system was shut down at 2024-09-30 04:12:00 UTC
db-1   | 2024-09-30 04:54:35.900 UTC [1] LOG:  database system is ready to accept connections
app-1  | wait-for-it: waiting 30 seconds for db:5432
app-1  | wait-for-it: db:5432 is available after 5 seconds
app-1  | Database is up
app-1  | Checking if database exists
app-1  | Running migrations
app-1  |
app-1  | Sequelize CLI [Node: 14.21.3, CLI: 6.6.2, ORM: 6.37.3]
app-1  |
app-1  | Loaded configuration file "config/config.js".
app-1  | Using environment "production".
app-1  | No migrations were executed, database schema was already up to date.
app-1  | Seeding reference data
app-1  |
app-1  | Sequelize CLI [Node: 14.21.3, CLI: 6.6.2, ORM: 6.37.3]
app-1  |
app-1  | Loaded configuration file "config/config.js".
app-1  | Using environment "production".
app-1  | == 20240903094906-seed-movies: migrating =======
app-1  | == 20240903094906-seed-movies: migrated (0.005s)
app-1  |
app-1  | Starting application
app-1  | Setting up bookmark routes...
app-1  | Setting up movies routes...
app-1  | Registering routes...
app-1  | JWT_SECRET is set: true
app-1  | Server is running on http://localhost:3000
app-1  | Auth Header: undefined
app-1  | No token provided
app-1  | Auth Header: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MzMsInVzZXJuYW1lIjoic3Jpc3VoYXJ0b184YjdmZThlMiIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzI3NjY1NTE5LCJleHAiOjE3Mjc2NjkxMTl9.M11h8H9FQRBk93so5P9hZpeCQ8fAZ1mT1umTQd-6O-8
app-1  | JWT Verification Error: TokenExpiredError: jwt expired
app-1  |     at /usr/src/app/node_modules/jsonwebtoken/verify.js:190:21
app-1  |     at getSecret (/usr/src/app/node_modules/jsonwebtoken/verify.js:97:14)
app-1  |     at Object.module.exports [as verify] (/usr/src/app/node_modules/jsonwebtoken/verify.js:101:10)
app-1  |     at authenticateToken (/usr/src/app/middleware/authenticateToken.js:14:7)
app-1  |     at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
app-1  |     at trim_prefix (/usr/src/app/node_modules/express/lib/router/index.js:328:13)
app-1  |     at /usr/src/app/node_modules/express/lib/router/index.js:286:9
app-1  |     at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
app-1  |     at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
app-1  |     at Function.handle (/usr/src/app/node_modules/express/lib/router/index.js:175:3) {
app-1  |   expiredAt: 2024-09-30T04:05:19.000Z
app-1  | }
app-1  | Executing (default): SELECT "id" FROM "Users" AS "User" WHERE ("User"."username" = 'andikusuma_d0235245' OR "User"."email" = 'andikusuma_d0235245@mail.web.id') LIMIT 1;
app-1  | bcryptHash: 61.939ms
app-1  | Executing (default): INSERT INTO "Users" ("id","username","email","password","role","createdAt","updatedAt") VALUES (DEFAULT,$1,$2,$3,$4,$5,$6) RETURNING "id","name","username","email","password","role","address","phoneNumber","createdAt","updatedAt";
app-1  | User creation: 10.909ms
app-1  | Login attempt for username: andikusuma_d0235245
app-1  | Executing (default): SELECT "id", "name", "username", "email", "password", "role", "address", "phoneNumber", "createdAt", "updatedAt" FROM "Users" AS "User" WHERE "User"."username" = 'andikusuma_d0235245';
app-1  | bcryptCompare: 76.535ms
app-1  | Login successful for user: andikusuma_d0235245
app-1  | Auth Header: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwidXNlcm5hbWUiOiJhbmRpa3VzdW1hX2QwMjM1MjQ1Iiwicm9sZSI6InVzZXIiLCJpYXQiOjE3Mjc2NzIyMDgsImV4cCI6MTcyNzY3NTgwOH0.1_6kAOAPonnt3w3oYS38cvd4Se6iJxkcV15037ojhbU
app-1  | Decoded JWT: {
app-1  |   id: 1,
app-1  |   username: 'andikusuma_d0235245',
app-1  |   role: 'user',
app-1  |   iat: 1727672208,
app-1  |   exp: 1727675808
app-1  | }
app-1  | Executing (default): SELECT "id", "title", "synopsis", "trailerUrl", "imgUrl", "rating", "status", "createdAt", "updatedAt" FROM "Movies" AS "Movie";
app-1  | Auth Header: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwidXNlcm5hbWUiOiJhbmRpa3VzdW1hX2QwMjM1MjQ1Iiwicm9sZSI6InVzZXIiLCJpYXQiOjE3Mjc2NzIyMDgsImV4cCI6MTcyNzY3NTgwOH0.1_6kAOAPonnt3w3oYS38cvd4Se6iJxkcV15037ojhbU
app-1  | Decoded JWT: {
app-1  |   id: 1,
app-1  |   username: 'andikusuma_d0235245',
app-1  |   role: 'user',
app-1  |   iat: 1727672208,
app-1  |   exp: 1727675808
app-1  | }
app-1  | Received addBookmark request - userId: 1 movieId: 8
app-1  | Executing (default): SELECT "id", "userId", "movieId", "createdAt", "updatedAt" FROM "Bookmarks" AS "Bookmark" WHERE "Bookmark"."userId" = 1 AND "Bookmark"."movieId" = '8' LIMIT 1;
app-1  | Executing (default): SELECT "id", "name", "username", "email", "password", "role", "address", "phoneNumber", "createdAt", "updatedAt" FROM "Users" AS "User" WHERE "User"."id" = 1;
app-1  | User found: 1
app-1  | Executing (default): SELECT "id", "title", "synopsis", "trailerUrl", "imgUrl", "rating", "status", "createdAt", "updatedAt" FROM "Movies" AS "Movie" WHERE "Movie"."id" = '8';
app-1  | Movie found: 8
app-1  | Executing (a88bda59-73b4-4792-95ce-ca17709674cf): START TRANSACTION;
app-1  | Executing (a88bda59-73b4-4792-95ce-ca17709674cf): INSERT INTO "Bookmarks" ("id","userId","movieId","createdAt","updatedAt") VALUES (DEFAULT,$1,$2,$3,$4) RETURNING "id","userId","movieId","createdAt","updatedAt";
app-1  | Executing (a88bda59-73b4-4792-95ce-ca17709674cf): COMMIT;
app-1  | New bookmark created: 1
app-1  | Auth Header: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwidXNlcm5hbWUiOiJhbmRpa3VzdW1hX2QwMjM1MjQ1Iiwicm9sZSI6InVzZXIiLCJpYXQiOjE3Mjc2NzIyMDgsImV4cCI6MTcyNzY3NTgwOH0.1_6kAOAPonnt3w3oYS38cvd4Se6iJxkcV15037ojhbU
app-1  | Decoded JWT: {
app-1  |   id: 1,
app-1  |   username: 'andikusuma_d0235245',
app-1  |   role: 'user',
app-1  |   iat: 1727672208,
app-1  |   exp: 1727675808
app-1  | }
app-1  | Starting getBookmarks function
app-1  | Request user: {
app-1  |   id: 1,
app-1  |   username: 'andikusuma_d0235245',
app-1  |   role: 'user',
app-1  |   iat: 1727672208,
app-1  |   exp: 1727675808
app-1  | }
app-1  | Fetching bookmarks for userId=1
app-1  | Executing (default): SELECT "Bookmark"."id", "Bookmark"."userId", "Bookmark"."movieId", "Bookmark"."createdAt", "Bookmark"."updatedAt", "Movie"."id" AS "Movie.id", "Movie"."title" AS "Movie.title", "Movie"."synopsis" AS "Movie.synopsis", "Movie"."trailerUrl" AS "Movie.trailerUrl", "Movie"."imgUrl" AS "Movie.imgUrl", "Movie"."rating" AS "Movie.rating", "Movie"."status" AS "Movie.status", "Movie"."createdAt" AS "Movie.createdAt", "Movie"."updatedAt" AS "Movie.updatedAt" FROM "Bookmarks" AS "Bookmark" LEFT OUTER JOIN "Movies" AS "Movie" ON "Bookmark"."movieId" = "Movie"."id" WHERE "Bookmark"."userId" = 1;
app-1  | Found 1 bookmarks
Gracefully stopping... (press Ctrl+C again to force)
[+] Stopping 2/2
 ✔ Container final-project-v2-app-1  Stopped                                                                           10.2s
 ✔ Container final-project-v2-db-1   Stopped                                                                            0.1s
Adhiems-MacBook-Air:final-project-v2 adhiemsumitro$ docker save -o myapp.tar myapp
